name: Deep Diagnose Project

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  diagnose:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Analyze repository structure
      run: |
        echo "ğŸ” æ·±åº¦åˆ†æä»“åº“ç»“æ„..."
        echo ""
        echo "ğŸ“Š ä»“åº“æ€»å¤§å°ï¼š"
        du -sh . || echo "æ— æ³•è®¡ç®—å¤§å°"
        echo ""
        echo "ğŸ“ æ ¹ç›®å½•è¯¦ç»†å†…å®¹ï¼š"
        ls -la
        echo ""
        echo "ğŸ“ æ‰€æœ‰å­ç›®å½•ï¼š"
        find . -maxdepth 2 -type d | sort
        echo ""
        echo "ğŸ“‹ æ‰€æœ‰ Gradle æ–‡ä»¶ï¼š"
        find . -name "*.gradle" -type f | sort
        echo ""
        echo "ğŸ“‹ æ‰€æœ‰ Gradle å±æ€§æ–‡ä»¶ï¼š"
        find . -name "gradle.properties" -type f | sort
        echo ""
        echo "ğŸ˜ Gradle Wrapper æ£€æŸ¥ï¼š"
        ls -la gradlew* 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ° gradlew"
        ls -la gradle/ 2>/dev/null || echo "æ²¡æœ‰ gradle ç›®å½•"
        
    - name: Check Android project structure
      run: |
        echo "ğŸ¤– Android é¡¹ç›®ç»“æ„æ£€æŸ¥ï¼š"
        echo ""
        echo "ğŸ“± æŸ¥æ‰¾ AndroidManifest.xmlï¼š"
        find . -name "AndroidManifest.xml" -type f | head -10
        echo ""
        echo "ğŸ“¦ æŸ¥æ‰¾ build.gradle æ–‡ä»¶ï¼š"
        find . -name "build.gradle" -type f | head -10
        echo ""
        echo "ğŸ”§ æŸ¥çœ‹ settings.gradleï¼š"
        if [ -f "settings.gradle" ]; then
          cat settings.gradle
        else
          echo "æ²¡æœ‰ settings.gradle æ–‡ä»¶"
        fi
        echo ""
        echo "ğŸ“ æŸ¥çœ‹é¡¹ç›®é…ç½®ï¼š"
        if [ -f "build.gradle" ]; then
          echo "æ ¹ç›®å½• build.gradle å†…å®¹ï¼š"
          head -30 build.gradle
        fi
        
    - name: Check source code structure
      run: |
        echo "ğŸ“š æºä»£ç ç»“æ„æ£€æŸ¥ï¼š"
        echo ""
        echo "ğŸ¦ Java æ–‡ä»¶ç»Ÿè®¡ï¼š"
        find . -name "*.java" -type f | wc -l
        echo ""
        echo "ğŸ“„ Java æ–‡ä»¶ä½ç½®ï¼š"
        find . -name "*.java" -type f | head -20
        echo ""
        echo "ğŸ” æŸ¥æ‰¾ CastActivityï¼š"
        find . -name "*CastActivity*" -type f
        echo ""
        echo "ğŸ“ ä¸»è¦çš„åŒ…ç»“æ„ï¼š"
        find . -name "*.java" -type f | sed 's/\/[^/]*$//' | sort | uniq | head -20
