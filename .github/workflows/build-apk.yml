name: Debug Build Process

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        java-version: 17
        distribution: 'temurin'
        
    - name: Check project structure
      run: |
        echo "📁 项目根目录内容："
        ls -la
        echo ""
        echo "📁 app 目录内容："
        ls -la app/ || echo "没有 app 目录"
        echo ""
        echo "🔍 查找所有 build.gradle 文件："
        find . -name "build.gradle" -type f
        echo ""
        echo "🔍 查找 CastActivity 文件："
        find . -name "*CastActivity*" -type f
        
    - name: Check gradle files
      run: |
        echo "📋 检查 app/build.gradle 内容："
        if [ -f "app/build.gradle" ]; then
          head -50 app/build.gradle
        else
          echo "app/build.gradle 不存在"
        fi
        
    - name: Try to build with detailed error info
      run: |
        chmod +x ./gradlew
        ./gradlew clean --no-daemon || true
        ./gradlew tasks --no-daemon | grep assemble || true
        
    - name: Attempt basic build
      run: |
        echo "尝试构建调试版本..."
        ./gradlew assembleDebug --no-daemon --stacktrace || echo "构建失败，继续执行"
        
    - name: Check build results
      run: |
        echo "🔍 检查构建输出："
        find . -name "*.apk" -type f 2>/dev/null | head -20 || echo "没有找到 APK 文件"
        echo ""
        echo "📁 build 目录结构："
        find app/build -type d 2>/dev/null | head -20 || echo "没有 build 目录"
