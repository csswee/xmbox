name: Debug Build Process

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        java-version: 17
        distribution: 'temurin'
        
    - name: Check project structure
      run: |
        echo "ðŸ“ é¡¹ç›®æ ¹ç›®å½•å†…å®¹ï¼š"
        ls -la
        echo ""
        echo "ðŸ“ app ç›®å½•å†…å®¹ï¼š"
        ls -la app/ || echo "æ²¡æœ‰ app ç›®å½•"
        echo ""
        echo "ðŸ” æŸ¥æ‰¾æ‰€æœ‰ build.gradle æ–‡ä»¶ï¼š"
        find . -name "build.gradle" -type f
        echo ""
        echo "ðŸ” æŸ¥æ‰¾ CastActivity æ–‡ä»¶ï¼š"
        find . -name "*CastActivity*" -type f
        
    - name: Check gradle files
      run: |
        echo "ðŸ“‹ æ£€æŸ¥ app/build.gradle å†…å®¹ï¼š"
        if [ -f "app/build.gradle" ]; then
          head -50 app/build.gradle
        else
          echo "app/build.gradle ä¸å­˜åœ¨"
        fi
        
    - name: Try to build with detailed error info
      run: |
        chmod +x ./gradlew
        ./gradlew clean --no-daemon || true
        ./gradlew tasks --no-daemon | grep assemble || true
        
    - name: Attempt basic build
      run: |
        echo "å°è¯•æž„å»ºè°ƒè¯•ç‰ˆæœ¬..."
        ./gradlew assembleDebug --no-daemon --stacktrace || echo "æž„å»ºå¤±è´¥ï¼Œç»§ç»­æ‰§è¡Œ"
        
    - name: Check build results
      run: |
        echo "ðŸ” æ£€æŸ¥æž„å»ºè¾“å‡ºï¼š"
        find . -name "*.apk" -type f 2>/dev/null | head -20 || echo "æ²¡æœ‰æ‰¾åˆ° APK æ–‡ä»¶"
        echo ""
        echo "ðŸ“ build ç›®å½•ç»“æž„ï¼š"
        find app/build -type d 2>/dev/null | head -20 || echo "æ²¡æœ‰ build ç›®å½•"
