name: Deep Diagnose Project

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  diagnose:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Analyze repository structure
      run: |
        echo "🔍 深度分析仓库结构..."
        echo ""
        echo "📊 仓库总大小："
        du -sh . || echo "无法计算大小"
        echo ""
        echo "📁 根目录详细内容："
        ls -la
        echo ""
        echo "📁 所有子目录："
        find . -maxdepth 2 -type d | sort
        echo ""
        echo "📋 所有 Gradle 文件："
        find . -name "*.gradle" -type f | sort
        echo ""
        echo "📋 所有 Gradle 属性文件："
        find . -name "gradle.properties" -type f | sort
        echo ""
        echo "🐘 Gradle Wrapper 检查："
        ls -la gradlew* 2>/dev/null || echo "没有找到 gradlew"
        ls -la gradle/ 2>/dev/null || echo "没有 gradle 目录"
        
    - name: Check Android project structure
      run: |
        echo "🤖 Android 项目结构检查："
        echo ""
        echo "📱 查找 AndroidManifest.xml："
        find . -name "AndroidManifest.xml" -type f | head -10
        echo ""
        echo "📦 查找 build.gradle 文件："
        find . -name "build.gradle" -type f | head -10
        echo ""
        echo "🔧 查看 settings.gradle："
        if [ -f "settings.gradle" ]; then
          cat settings.gradle
        else
          echo "没有 settings.gradle 文件"
        fi
        echo ""
        echo "📝 查看项目配置："
        if [ -f "build.gradle" ]; then
          echo "根目录 build.gradle 内容："
          head -30 build.gradle
        fi
        
    - name: Check source code structure
      run: |
        echo "📚 源代码结构检查："
        echo ""
        echo "🐦 Java 文件统计："
        find . -name "*.java" -type f | wc -l
        echo ""
        echo "📄 Java 文件位置："
        find . -name "*.java" -type f | head -20
        echo ""
        echo "🔍 查找 CastActivity："
        find . -name "*CastActivity*" -type f
        echo ""
        echo "📁 主要的包结构："
        find . -name "*.java" -type f | sed 's/\/[^/]*$//' | sort | uniq | head -20
